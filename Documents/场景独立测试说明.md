# 场景独立测试说明

## ✅ 已完成

现在**大厅场景**和**游戏关卡场景**都可以独立测试，无需依赖其他场景。

## 功能说明

### 自动场景检测

`GameManager` 现在会自动检测当前场景类型并初始化：

- **大厅场景**: 场景名包含 "Lobby" → 自动调用 `InitializeLobby()`
- **游戏关卡场景**: 场景名包含 "Main"、"Level" 或 "Game" → 自动调用 `StartGame()`
- **主菜单场景**: 由 `MainMenuManager` 管理

### 独立测试模式

#### 1. 大厅场景独立测试

**步骤**:
1. 在 Unity 中直接打开 `Lobby` 场景
2. 确保场景中有 `GameManager` 组件（会自动创建）
3. 在 Inspector 中配置：
   - 大厅NPC列表（`_lobbyNPCs`）
   - UI引用（按钮、面板等）
   - 关卡列表（`_levels`）
4. 点击 Play，自动初始化大厅场景

**功能**:
- ✅ 玩家自动创建
- ✅ 大厅NPC自动生成（商人、铁匠、训练师等）
- ✅ 关卡选择UI可用
- ✅ 所有大厅功能可用

#### 2. 游戏关卡场景独立测试

**步骤**:
1. 在 Unity 中直接打开 `Main` 场景（或任何关卡场景）
2. 确保场景中有 `GameManager` 组件（会自动创建）
3. 点击 Play，自动初始化游戏关卡

**功能**:
- ✅ 玩家自动创建
- ✅ 关卡NPC自动生成
- ✅ 刷怪点自动加载
- ✅ 测试物品自动生成
- ✅ 所有游戏功能可用

## 配置选项

### GameManager Inspector 配置

- **Auto Initialize Scene**: 是否自动检测场景并初始化
  - ✅ 勾选：自动检测并初始化（推荐，支持独立测试）
  - ❌ 取消：手动控制初始化（通过代码调用）

## 场景切换

### 正常流程（通过 SceneManager）

```
主菜单 → 大厅 → 游戏关卡
```

### 独立测试（直接打开场景）

```
直接打开 Lobby 场景 → 自动初始化
直接打开 Main 场景 → 自动初始化
```

## 注意事项

1. **避免重复初始化**
   - `GameManager` 会检查当前状态，避免重复初始化
   - 如果场景已经初始化，会跳过

2. **场景命名规范**
   - 大厅场景：名称包含 "Lobby"
   - 关卡场景：名称包含 "Main"、"Level" 或 "Game"
   - 主菜单：名称包含 "Menu"

3. **GameManager 单例**
   - `GameManager` 是单例，`DontDestroyOnLoad`
   - 场景切换时不会销毁，会保留状态

4. **玩家数据保留**
   - 场景切换时玩家数据会保留
   - 只移动玩家位置，不重新创建

## 测试建议

### 开发阶段

1. **测试大厅功能**:
   - 直接打开 `Lobby` 场景
   - 测试NPC交互、关卡选择、商店等功能

2. **测试关卡功能**:
   - 直接打开 `Main` 场景
   - 测试战斗、NPC、刷怪点等功能

3. **测试完整流程**:
   - 使用 `SceneManager` 切换场景
   - 测试场景切换和数据保留

### 调试技巧

- 查看 Console 日志，了解初始化流程
- 使用 `_autoInitializeScene` 控制是否自动初始化
- 可以在代码中手动调用 `InitializeLobby()` 或 `StartGame()`

## 优势

1. ✅ **独立测试**: 每个场景都可以独立测试
2. ✅ **快速迭代**: 不需要启动完整流程
3. ✅ **灵活开发**: 可以专注于单个场景的功能
4. ✅ **向后兼容**: 正常流程仍然可用

