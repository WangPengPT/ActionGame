# 游戏模式使用说明

## 概述

游戏现在支持三种模式：
- **Offline（单机模式）**：开发测试用，无需网络连接
- **LAN（局域网模式）**：直连模式，适合局域网内联机
- **Relay（中继服务器模式）**：公网联机，通过中继服务器转发消息

## 快速开始

### 方式一：使用 GameStarter 组件（推荐）

1. 在场景中创建一个空的 GameObject
2. 添加 `GameStarter` 组件
3. 在 Inspector 中配置：
   - **Use Config**: 是否使用配置文件（推荐勾选）
   - **Game Mode**: 选择游戏模式
   - **Auto Start**: 是否自动开始游戏
   - **Show Debug UI**: 是否显示调试UI

4. 运行游戏，会自动根据配置启动

### 方式二：使用配置文件

1. 在 Unity 中右键点击 Project 窗口
2. 选择 `Create -> Game -> Game Config`
3. 配置参数：
   - **Default Mode**: 默认游戏模式
   - **Relay Server IP**: 中继服务器地址
   - **Server Port**: 服务器端口
   - 其他参数...

4. 将配置文件保存到 `Assets/Resources/` 目录下，命名为 `GameConfig.asset`

5. 在代码中或 GameStarter 中勾选 `Use Config`

### 方式三：代码调用

```csharp
// 获取游戏模式管理器
var gm = GameModeManager.Instance;

// 设置模式
gm.SetOfflineMode();  // 单机模式
gm.SetLANMode();      // 局域网模式
gm.SetRelayMode();    // 中继模式

// 一键单机测试（开发时最常用）
gm.QuickStartOffline();

// 或者手动创建房间并开始
gm.CreateRoom("测试房间");
gm.StartGame();
```

## 开发流程

### 开发阶段（单机模式）

1. 在 `GameStarter` 或 `GameConfig` 中设置模式为 `Offline`
2. 运行游戏，会自动创建单机房间并开始游戏
3. 所有游戏逻辑正常执行，无需网络连接
4. 可以正常测试所有功能

### 测试阶段（局域网模式）

1. 设置模式为 `LAN`
2. 一台机器作为主机：调用 `CreateRoom()`
3. 其他机器作为客户端：调用 `JoinRoom(roomId)`
4. 房主调用 `StartGame()` 开始游戏

### 发布阶段（中继模式）

1. 设置模式为 `Relay`
2. 确保中继服务器已启动（运行 `RelayServer/run_server.bat`）
3. 配置正确的服务器IP和端口
4. 调用 `Connect()` 连接服务器
5. 创建或加入房间
6. 开始游戏

## 统一API

`GameModeManager` 提供了统一的API，无论什么模式都可以使用相同的方法：

```csharp
// 连接（单机模式会自动成功）
gm.Connect();

// 创建房间
gm.CreateRoom("房间名", maxPlayers: 4, password: "");

// 加入房间
gm.JoinRoom(roomId, password: "");

// 开始游戏
gm.StartGame();

// 离开房间
gm.LeaveRoom();

// 发送聊天
gm.SendChat("消息内容");

// 获取当前房间
var room = gm.GetCurrentRoom();

// 获取所有玩家
var players = gm.GetAllPlayers();
```

## 调试UI

在运行时，如果启用了 `Show Debug UI`，会在屏幕左上角显示：
- 当前游戏模式
- 连接状态
- 是否房主
- 玩家ID
- 房间信息
- 模式切换按钮
- 操作按钮
- **一键单机测试**按钮（绿色，最常用）

## 注意事项

1. **单机模式**：
   - 永远是房主
   - 玩家ID固定为0
   - 无需网络连接
   - 适合开发测试

2. **局域网模式**：
   - 需要先启动主机
   - 客户端需要知道主机的IP地址
   - 适合局域网内测试

3. **中继模式**：
   - 需要中继服务器运行
   - 适合公网联机
   - 支持断线重连

4. **模式切换**：
   - 切换模式会自动断开当前连接
   - 需要重新创建/加入房间

## 配置文件示例

在 `Assets/Resources/GameConfig.asset` 中配置：

```
Default Mode: Offline          // 开发时用Offline
Relay Server IP: 127.0.0.1     // 本地测试
Server Port: 7777
Default Player Name: Player
Show Debug UI: true
Auto Start Game: true
```

发布时修改为：

```
Default Mode: Relay            // 发布时用Relay
Relay Server IP: your-server.com
Server Port: 7777
Show Debug UI: false
Auto Start Game: false
```

## 常见问题

**Q: 开发时如何快速测试？**  
A: 使用 `GameModeManager.Instance.QuickStartOffline()` 或点击调试UI中的"一键单机测试"按钮。

**Q: 如何切换模式？**  
A: 在运行时通过调试UI切换，或修改 `GameConfig` 配置文件。

**Q: 单机模式能测试多人功能吗？**  
A: 单机模式只有本地玩家，无法测试多人同步。需要局域网或中继模式。

**Q: 如何知道当前是什么模式？**  
A: 查看调试UI，或使用 `GameModeManager.Instance.CurrentMode`。

